define("js/main",["bui/common","bui/module","bui/layout","bui/grid","bui/data","bui/tree","bui/imgview","bui/list","bui/tooltip"],function(a){function b(a){b.superclass.constructor.call(this,a)}var c=a("bui/common"),d=a("bui/module"),e=a("bui/layout"),f=a("bui/list"),g=a("bui/imgview"),h=a("bui/tooltip"),i=a("bui/tree");return c.extend(b,d),c.augment(b,{_initData:function(){},_initDom:function(){this.__initLayout(),this.__initViewContent(),this.__initCenterSize(this),this.__initTree(),this.__initTab()},_initEvent:function(){this.__initResize(),this.__initKeyMaster(),this.__initMousewheel(),this.__initTreeEvent()},__initLayout:function(){var a=this,b=new e.Viewport({elCls:"ext-border-layout",children:[{layout:{region:"north",height:a.get("northHeight")},xclass:"controller",content:$(".north")},{layout:{region:"west",fit:"both",collapsable:!1,width:a.get("westWidth")},xclass:"controller",content:$(".west")},{layout:{region:"center",fit:"both"},xclass:"controller",content:$(".center")}],plugins:[e.Border],autoRender:!0});this.set("layout",b)},__initViewContent:function(){for(var a=this,b=a.get("viewContents"),d=a.get("viewContentCfg"),e=(a.get("defaultImgs"),a.get("activeImgView"),a.get("viewWraps")),f=0;f<e.length;f++){var h=e[f];b.push(new g.ViewContent(c.mix(d,{width:h.width(),height:h.height(),render:h,imgSrc:a.get("imgSrc"+f),autoRender:!0})))}a.set("viewContents",b)},__initCenterSize:function(a,b){var c=a.get("imgviewWrap"),d=a.get("viewContents"),b="number"==typeof b?b:a.get("wrapModel"),e=$(a.get("centerWrap")),f=a.get("previewListHeight"),g=e.width(),h=e.height(),i=(c.attr("class"),a.get("viewWraps"));c.height(h-f);for(var j=0;j<i.length;j++){var k=i[j],l=d[j];b>=j?k.show():k.hide();var m=parseInt(g/(b+1))-4,n=h-f-4;k.width(m).height(n),l.set("width",m),l.set("height",n)}a.set("centerWrap",e)},__initTree:function(){var a=this,b=a.get("nodes"),c=new i.TreeList({render:".west",nodes:b,autoRender:!0});a.set("tree",c)},__initSimpleList:function(){var a=this,b=new f.SimpleList({elCls:a.get("listCls"),render:a.get("previewListWrap"),itemTpl:a.get("itemTpl"),autoRender:!0});b.get("el").find("ul").addClass("clearfix"),a.set("list",b)},__initResize:function(){var a=this,b=a.get("centerWrap");b.resize(function(){a.__initCenterSize(a)}),screenfull.enabled&&$(window).resize(function(){var b=$(".x-border-center");b.css(screenfull.isFullscreen?{zIndex:1e3,width:screen.width,height:screen.height+a.get("previewListHeight"),left:-a.get("westWidth")-1,top:-a.get("northHeight")}:{zIndex:0,width:"",height:"",left:0,top:0})})},__initKeyMaster:function(){var a=this,b=a.get("keyCommands");for(keyName in b)!function(b,c){"function"==typeof c?key(b,function(){return c(a.__getKeyTarget(),a),!1}):key(b,function(){return a.__getKeyTarget()[c](),!1})}(keyName,b[keyName])},__initMousewheel:function(){for(var a=this,b=a.get("viewWraps"),c=a.get("viewContents"),d=0;d<b.length;d++){{b[d]}!function(b,c,d){c.mousewheel(function(b,c){a.get("canMove")&&(a.set("canMove",!1),setTimeout(function(){a.set("canMove",!0)},300),c>0?d.zoom(function(){a.set("canMove",!0)}):0>c&&d.micrify(function(){a.set("canMove",!0)})),b.stopPropagation(),b.preventDefault()})}(d,b[d],c[d])}$(document).mousewheel(function(b,d){viewContent=c[a.get("activeImgView")],a.get("canMove")&&(a.set("canMove",!1),setTimeout(function(){a.set("canMove",!0)},300),d>0?viewContent.zoom(function(){a.set("canMove",!0)}):0>d&&viewContent.micrify(function(){a.set("canMove",!0)}))})},__initTreeEvent:function(){var a=this,b=(a.get("list"),a.get("tree"));b.on("itemclick",function(b){var c=b.item,d=a.get("treeImgList"),e=(a.get("activeImgView"),[]);if(c.leaf){if(void 0===d||d===[]||-1==d.indexOf(c)){d=[];for(var f=0;f<c.parent.children.length;f++){var g=c.parent.children[f];g.leaf&&(e.push({src:g.src,miniSrc:g.miniSrc}),d.push(g))}a.set("treeImgList",d),a.set("imgList",e)}else e=a.get("imgList");var h=d.indexOf(c);a.set("selected",h),a._previewListScroll(h)}else{d=[];for(var f=0;f<c.children.length;f++){var g=c.children[f];g.leaf&&(e.push({src:g.src,miniSrc:g.miniSrc}),d.push(g))}a.set("selected",0),a.set("treeImgList",d),e.length&&a.set("imgList",e)}})},__getKeyTarget:function(){var a=this.get("activeImgView");return this.get("viewContents")[a]},_previewListScroll:function(a){$("#preview-list-wrap").scrollLeft(this.get("itemWidth")*(a+1)+20-$("#preview-list-wrap").width())},_setTreeSelect:function(a){var b=this,c=b.get("tree"),d=b.get("treeImgList");d&&c.setSelected(d[a])},_paintPrev:function(){var a=this,b=a.get("imgList").length,c=(a.get("selected")+b-1)%b;a.set("selected",c),a._previewListScroll(c)},_paintNext:function(){var a=this,b=(a.get("selected")+1)%a.get("imgList").length;a.set("selected",b),a._previewListScroll(b)},__initTab:function(){var a=this;a.get("tabs").on("click",function(){var b=$(this).index();return a.set("tabIndex",b),a.set("wrapModel",b),a.set("activeImgView",b),!1}),$(".imgview-content").on("click",function(b){b.preventDefault();var c=$(this);a.set("activeImgView",c.index())}),$(".btn-cmd-group a").on("click",function(b){b.preventDefault();var c=jQuery(this),d=c.data("cmd");"_"==d.substr(0,1)?a[d]():a.get("viewContents")[a.get("activeImgView")][d]()});var b=new h.Tips({tip:{trigger:".btn-group-item",alignType:"bottom-left",elCls:"tips",offset:10}});b.render()},_fullScreen:function(){screenfull.enabled&&screenfull.toggle()}}),b.ATTRS={imgviewWrap:{value:$("#imgview-wrap")},keyCommands:{value:{q:"leftHand",e:"rightHand",w:"zoom",s:"micrify",r:"reset",f:"fitToggle",x:function(a,b){b.set("selected",b.get("selected"))},"a,left,up":function(a,b){b._paintPrev()},"d,right,down":function(a,b){b._paintNext()},1:function(a,b){b.get("tabs").eq(0).click()},2:function(a,b){b.get("tabs").eq(1).click()},3:function(a,b){b.get("tabs").eq(2).click()},"`,tab":function(a,b){b.set("activeImgView",(b.get("activeImgView")+1)%(b.get("wrapModel")+1))},g:function(a,b){b._fullScreen()}}},centerWrap:{value:".x-border-center"},tabs:{value:$(".btn-group .btn-tabs")},viewWraps:{value:[$("#imgview-content-1"),$("#imgview-content-2"),$("#imgview-content-3")]},viewContents:{value:[]},tabIndex:{value:0,setter:function(a){var b=this.get("tabs");return b.removeClass("btn-group-active"),b.eq(a).addClass("btn-group-active"),a}},cookieReg:{value:"FinderCookie"},wrapModel:{value:0,setter:function(a){return this.get("hasInit")&&this.__initCenterSize(this,a),this.set("tabIndex",a),$.cookie("wrapModel"+this.get("cookieReg"),a),a}},activeImgView:{value:0,setter:function(a){var b=this,c=b.get("viewWraps");return $(".imgview-content-inner").removeClass("imgview-content-active"),c[a].addClass("imgview-content-active"),$.cookie("activeImgView"+this.get("cookieReg"),a),a}},northHeight:{value:55},westWidth:{value:250},previewListHeight:{value:120,setter:function(a){return $(".preview-list-wrap").height(a),a}},viewContentCfg:{value:{imgSrc:"https://s.tbcdn.cn/g/fi/act/finder/img/hello.png",rotateTime:300,scaleTime:300,overflowSize:100,drag:!0}},imgListSource:{value:"imgList.htm"},previewList:{value:$(".previewList")},previewListWrap:{value:$("#preview-list-wrap")},listCls:{value:"previewList"},itemWidth:{value:114},itemHeight:{value:86},itemTpl:{value:'<li class="preview-item"></li>'},imgList:{value:[],setter:function(a){if(a.length){var b=this,c=(b.get("previewList"),b.get("activeImgView")),d=b.get("itemWidth"),e=b.get("itemHeight"),f=(b.get("selected"),b.get("list"));b.get("hasInit")||(b.__initSimpleList(),f=b.get("list")),f.set("items",a),f.get("el").find("ul").width(a.length*d),f.get("el").find("li").each(function(b){$(this).width(d-4).height(e-4).loadCenterImg(a[b].miniSrc)}).on("click",function(a){a.preventDefault(),b.set("selected",$(this).index())});var g;f.get("el").find("li").hover(function(){if("hover"===b.get("previewTrigger")){var a=$(this);clearInterval(g),g=setTimeout(function(){var c=a.index();b.set("selected",c),b._previewListScroll(c)},b.get("hoverDelay"))}}),b.get("hasInit")?(f.setSelected(a[0]),b.set("imgSrc"+c,a[0].src)):f.setSelected(a[b.get("selected")]),$.cookie("imgList"+this.get("cookieReg"),$.stringify(a))}return a}},selected:{value:0,setter:function(a){if(this.get("hasInit")){var b=this,c=b.get("list"),d=b.get("imgList"),e=b.get("activeImgView");c.setSelected(d[a]),b.set("imgSrc"+e,d[a].src),b._setTreeSelect(a)}return $.cookie("selected"+this.get("cookieReg"),a),a}},canMove:{value:!0},imgSrc0:{value:"https://s.tbcdn.cn/g/fi/act/finder/img/hello.png",setter:function(a){return this.get("hasInit")&&this.get("viewContents")[0].set("imgSrc",a),$.cookie("imgSrc0"+this.get("cookieReg"),a),a}},imgSrc1:{value:"https://s.tbcdn.cn/g/fi/act/finder/img/hello.png",setter:function(a){return this.get("hasInit")&&this.get("viewContents")[1].set("imgSrc",a),$.cookie("imgSrc1"+this.get("cookieReg"),a),a}},imgSrc2:{value:"https://s.tbcdn.cn/g/fi/act/finder/img/hello.png",setter:function(a){return this.get("hasInit")&&this.get("viewContents")[2].set("imgSrc",a),$.cookie("imgSrc2"+this.get("cookieReg"),a),a}},previewTrigger:{value:"click"},hoverDelay:{value:0}},b});